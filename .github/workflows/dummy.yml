# yamllint disable rule:line-length
---
  name: Dummy Workflow
  permissions:
    contents: read
  on:
    workflow_dispatch:
  
  jobs:
    prepare:
      runs-on: ubuntu-20.04
      name: Generate data for jobs
      outputs:
        linux: ${{steps.data.outputs.linux}}
        mac: ${{steps.data.outputs.mac}}
      steps:
        - name: Generate data
          id: data
          shell: bash
          run: |
            for os in "linux" "mac";
            do
              stats="{"
              for type in "client" "desktop" "plugins";
              do
                stats+="\"${type}_coverage\":75.0,\"${type}_count\":1234,"
              done
              stats=${stats%?}
              stats+="}"
              echo "${os}=${stats}" >> "$GITHUB_OUTPUT"
            done

    process:
      needs: prepare
      runs-on: ubuntu-20.04
      name: Process data for jobs
      env:
        linux: ${{needs.prepare.outputs.linux}}
        mac: ${{needs.prepare.outputs.mac}}
      steps:
        - name: Process data
          shell: bash
          run: |
            for os in "linux" "mac";
            do
              for type in "client" "desktop" "plugins";
              do
                coverage=$(echo '${{env[format('{0}', '${os}')]}}' | jq -r .${type}_coverage)
                count=$(echo '${{env[format('{0}', '${os}')]}}' | jq .${type}_count)
                echo "${type}: ${coverage}%, ${count} tests"
              done
            done